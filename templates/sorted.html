<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='images/icon.png') }}">

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Bootstrap Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">

    <title>StepSort - Resultado</title>

    <style>
        body {
            background: #0d0d0d;
            color: #f0f0f0;
            padding: 25px;
        }

        .container-box {
            max-width: 1000px;
            margin: auto;
            background: rgba(255,255,255,0.06);
            padding: 30px;
            border-radius: 18px;
            box-shadow: 0 0 18px rgba(0,0,0,0.5);
        }

        .info-card {
            background: rgba(255,255,255,0.06);
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 10px;
        }

        #steps {
            max-height: 450px;
            overflow-y: auto;
            padding: 20px;
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .animated-step {
            padding: 10px;
            background: rgba(255,255,255,0.08);
            border-radius: 10px;
            margin-bottom: 10px;
        }

        /* ===================== */
        /* BOTÕES CUSTOMIZADOS   */
        /* ===================== */

        .btn-custom {
            background: #28cee3;
            color: black;
            border-radius: 10px;
            font-weight: bold;
            border: none;
            transition: all 0.2s ease-in-out;
        }
        .btn-custom:hover {
            background: #1bb1c6;
        }

        .btn-yellow {
            background: #f8dc4c;
            color: black;
            border-radius: 10px;
            font-weight: bold;
            border: none;
        }
        .btn-yellow:hover {
            background: #e6c839;
        }

        /* ========================================== */
        /* BOTÕES DO RODAPÉ (IGUAIS AO INDEX)         */
        /* ========================================== */
        .footer-links a {
            display: inline-block;
            padding: 10px 18px;
            border-radius: 10px;
            border: 2px solid #ffffff; /* branco fininho */
            color: #ffffff; /* mesma fonte do index */
            text-decoration: none;
            transition: 0.25s;
        }

        .footer-links a:hover {
            background: rgba(255,255,255,0.12);
        }

    </style>

</head>

<body>

<div class="container-box">

    <h1 class="mb-4 text-center"> Execução de Ordenação</h1>

    <div class="info-card">
        <h5><i class="bi bi-person-fill"></i> Usuário: <span class="text-info">{{ player }}</span></h5>
        <h5><i class="bi bi-diagram-3-fill"></i> Algoritmo: <span class="text-warning">{{ method }}</span></h5>
        <h5><i class="bi bi-bar-chart-fill"></i> Complexidade: {{ complexity }}</h5>
        <h5><i class="bi bi-list-ol"></i> Comparações: {{ comparisons }} | Trocas: {{ swaps }}</h5>
        <h5><i class="bi bi-stopwatch-fill"></i> Tempo: <span class="text-warning">{{ elapsed_time }}s</span></h5>
        <h5><i class="bi bi-braces"></i> Lista Original: {{ originalArr }}</h5>
        <h5><i class="bi bi-check-circle-fill text-info"></i> Resultado Final: <span class="text-info">{{ sortedArr }}</span></h5>
    </div>

    <div class="mt-3 mb-4 text-center">

        {% if method != 'Sort Padrão (Python)' %}
            <button class="btn btn-custom me-2" data-bs-toggle="modal" data-bs-target="#scenarioModal">
                <i class="bi bi-graph-up-arrow"></i> Melhor/Pior Cenário
            </button>

            <button class="btn btn-yellow" data-bs-toggle="modal" data-bs-target="#compareModal">
                <i class="bi bi-graph-up"></i> Comparar Algoritmos
            </button>
        {% endif %}
    </div>

    {% if show_steps %}
        <h2 class="mt-4"><i class="bi bi-list-check text-info"></i> Processo de Ordenação</h2>
        <p id="animation-status" class="mb-2">Iniciando animação...</p>

        <div id="steps"></div>

        <script>
            const stepsData = {{ steps | tojson }};
            const stepsContainer = document.getElementById("steps");
            const statusElement = document.getElementById("animation-status");

            let currentStep = 0;
            const animationSpeed = 50;

            function showNextStep() {
                if (currentStep >= stepsData.length) {
                    statusElement.textContent = `Animação concluída! (${stepsData.length} etapas)`;
                    return;
                }

                const step = stepsData[currentStep];
                const listState = step[0];
                const swap = step[1];
                const stepIndex = currentStep + 1;

                const newStepEl = document.createElement('div');
                newStepEl.className = 'animated-step';

                let highlightedList = listState.map(v => {
                    if (v === swap[0] || v === swap[1]) {
                        return `<span style="color: #f8dc4c; font-weight: bold;">${v}</span>`;
                    }
                    return v;
                }).join(", ");

                newStepEl.innerHTML = `
                    <h6 class="text-warning">
                        <i class="bi bi-arrow-left-right"></i>
                        ${stepIndex}. Trocar
                        <span style="color:#f8dc4c; font-weight:bold;">${swap[0]}</span>
                        ↔
                        <span style="color:#f8dc4c; font-weight:bold;">${swap[1]}</span>
                    </h6>

                    <h6 class="text-info">[${highlightedList}]</h6>
                `;

                stepsContainer.appendChild(newStepEl);
                stepsContainer.scrollTop = stepsContainer.scrollHeight;

                statusElement.textContent = `Mostrando etapa ${stepIndex} de ${stepsData.length}...`;

                currentStep++;
                setTimeout(showNextStep, animationSpeed);
            }

            setTimeout(showNextStep, animationSpeed);
        </script>

    {% else %}
        <h2 class="mt-4 text-warning">
            <i class="bi bi-exclamation-triangle-fill"></i>
            Lista muito grande ({{ originalArr|length }} itens). Etapas não exibidas.
        </h2>
    {% endif %}

    <div class="footer-links mt-4 text-center">
        <a href="{{ url_for('index') }}"><i class="bi bi-arrow-left-circle"></i> Nova Ordenação</a>
        <a href="{{ url_for('history') }}"><i class="bi bi-clock-history"></i> Ver Histórico</a>
    </div>

</div>

<!-- MODAIS (mantidos iguais) -->
<div class="modal fade" id="scenarioModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-scrollable modal-lg">
        <div class="modal-content bg-dark text-light">

            <div class="modal-header">
                <h3 class="modal-title">
                    <i class="bi bi-graph-up-arrow text-info"></i>
                    Melhor e Pior Cenário — {{ method }}
                </h3>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>

            <div class="modal-body">

                <div class="info-card">
                    <h4><i class="bi bi-arrow-up-circle-fill"></i> Melhor Cenário</h4>
                    <p>{{ scenario_data.best_arr }}</p>
                    <p>Tempo: <span class="text-info">{{ scenario_data.best_results.time }}s</span></p>
                    <p>Comparações: {{ scenario_data.best_results.comp }} | Trocas: {{ scenario_data.best_results.swap }}</p>
                </div>

                <div class="info-card">
                    <h4><i class="bi bi-arrow-down-circle-fill"></i> Pior Cenário</h4>
                    <p>{{ scenario_data.worst_arr }}</p>
                    <p>Tempo: <span class="text-warning">{{ scenario_data.worst_results.time }}s</span></p>
                    <p>Comparações: {{ scenario_data.worst_results.comp }} | Trocas: {{ scenario_data.worst_results.swap }}</p>
                </div>

            </div>

        </div>
    </div>
</div>

<div class="modal fade" id="compareModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-scrollable modal-lg">
        <div class="modal-content bg-dark text-light">

            <div class="modal-header">
                <h3 class="modal-title">
                    <i class="bi bi-bar-chart-steps text-warning"></i>
                    Comparação de Algoritmos
                </h3>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>

            <div class="modal-body">

                <div class="info-card">
                    <h4><i class="bi bi-circle-fill text-info"></i> Bubble Sort</h4>
                    <p>Tempo: <span class="text-info">{{ comparison_data.bubble.time }}s</span></p>
                    <p>Comparações: {{ comparison_data.bubble.comp }} | Trocas: {{ comparison_data.bubble.swap }}</p>
                </div>

                <div class="info-card">
                    <h4><i class="bi bi-square-fill text-warning"></i> Selection Sort</h4>
                    <p>Tempo: <span class="text-warning">{{ comparison_data.selection.time }}s</span></p>
                    <p>Comparações: {{ comparison_data.selection.comp }} | Trocas: {{ comparison_data.selection.swap }}</p>
                </div>

            </div>

        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

</body>
</html>
